<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Pena Lux</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Preloader -->
    <div id="preloader" class="preloader">
        <div class="spinner"></div>
    </div>

    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <div id="loginPage" class="login-container">
        <h1>üßº –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
        <div class="form-group">
            <input type="text" id="login" placeholder="–õ–æ–≥–∏–Ω">
        </div>
        <div class="form-group">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
        </div>
        <button class="login-btn" onclick="login()">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
        
        <div style="margin-top: 25px; padding: 20px; background: rgba(26, 26, 26, 0.8); border-radius: 12px; text-align: left;">
            <strong style="display: block; margin-bottom: 10px; font-size: 16px;">–¢–µ—Å—Ç–æ–≤—ã–µ –¥–æ—Å—Ç—É–ø—ã:</strong>
            <div style="font-size: 14px; line-height: 1.5;">
                <div>üëë <strong>main</strong> / <strong>main123</strong> (–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω)</div>
                <div>üîß <strong>admin</strong> / <strong>123456</strong> (–ê–¥–º–∏–Ω)</div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div id="mainPage" class="container hidden">
        <div class="nav-header">
            <h1 style="margin: 0; font-size: 24px;">üßº –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
            <div class="user-menu">
                <span id="userRole" style="font-weight: 700; color: #FFFFFF; font-size: 16px;">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                <button class="btn btn-secondary" onclick="logout()" style="min-width: 120px;">–í—ã–π—Ç–∏</button>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="dashboard">
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div>
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
                        <div class="number" id="totalOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <div>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                        <div class="number" id="completedOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <div>–í —Ä–∞–±–æ—Ç–µ</div>
                        <div class="number" id="progressOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <div>–ù–æ–≤—ã—Ö</div>
                        <div class="number" id="newOrders">0</div>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ -->
                <div style="background: rgba(37, 37, 37, 0.8); padding: 30px; border-radius: 15px; border: 1px solid #333; margin: 25px 0;">
                    <h3 style="margin-top: 0; margin-bottom: 20px;">üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏</h3>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn" onclick="loadPrices()" style="background: #3498db;">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã</button>
                        <button class="btn" onclick="savePrices()" style="background: #10B981;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    </div>

                    <div id="pricesEditor">
                        <!-- –†–µ–¥–∞–∫—Ç–æ—Ä —Ü–µ–Ω –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ü–∏—è–º–∏ -->
                <div style="background: rgba(37, 37, 37, 0.8); padding: 30px; border-radius: 15px; border: 1px solid #333; margin: 25px 0;">
                    <h3 style="margin-top: 0; margin-bottom: 20px;">üéÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ü–∏—è–º–∏</h3>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn" onclick="showAddPromotionForm()" style="background: #10B981;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–∏—é</button>
                        <button class="btn" onclick="loadPromotions()" style="background: #3498db;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>

                    <div id="promotionsList">
                        <!-- –ê–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                <div style="background: rgba(37, 37, 37, 0.8); padding: 20px; border-radius: 15px; border: 1px solid #333; margin: 25px 0;">
                    <strong style="display: block; margin-bottom: 15px; font-size: 18px;">–§–∏–ª—å—Ç—Ä—ã –∑–∞—è–≤–æ–∫:</strong>
                    <select id="statusFilter" style="width: 100%; max-width: 300px; padding: 12px; background: rgba(26, 26, 26, 0.8); border: 2px solid #333; border-radius: 8px; color: #FFFFFF;">
                        <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="new">–ù–æ–≤—ã–µ</option>
                        <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ</option>
                        <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                        <option value="completed">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</option>
                    </select>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>–£—Å–ª—É–≥–∞</th>
                                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="ordersBody">
                            <!-- –ó–∞—è–≤–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div>
                <div class="calendar-sidebar">
                    <h3 style="margin-top: 0; margin-bottom: 20px;">üìÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º</h3>
                    
                    <div class="form-group">
                        <label for="calendarDate">–î–∞—Ç–∞:</label>
                        <input type="date" id="calendarDate" value="2024-01-15">
                    </div>

                    <div style="display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap;">
                        <button class="btn" onclick="blockSelectedSlots()" style="background: #e67e22;">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn" onclick="unblockSelectedSlots()" style="background: #10B981;">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="publishCalendar()" style="background: #10B981; width: 100%; margin-bottom: 10px;">üì¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å</button>
                        <button class="btn" onclick="viewClientCalendar()" style="background: #3498db; width: 100%; margin-bottom: 10px;">üëÄ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç</button>
                        <button class="btn" onclick="loadClientOrders()" style="background: #9b59b6; width: 100%;">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏</button>
                    </div>
                    
                    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
                    <div style="margin-top: 30px;">
                        <h4 style="margin: 0 0 15px 0;">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ <span id="currentDate">15 —è–Ω–≤–∞—Ä—è 2024</span></h4>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 10px;" id="calendarGrid">
                            <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                    
                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram -->
                    <div style="margin-top: 30px; padding-left: 15px; border-left: 4px solid #e74c3c;">
                        <h4 style="margin-top: 0; margin-bottom: 15px;">üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram</h4>
                        <div class="form-group">
                            <input type="text" id="telegramToken" placeholder="–¢–æ–∫–µ–Ω –±–æ—Ç–∞">
                        </div>
                        <div class="form-group">
                            <input type="text" id="telegramChatId" placeholder="ID —á–∞—Ç–∞">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="saveTelegramSettings()" style="background: #3498db; flex: 1;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button class="btn" onclick="testTelegramNotification()" style="background: #10B981; flex: 1;">üîî –¢–µ—Å—Ç</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
        let currentUser = null;
        let orders = [];
        let promotions = [];
        let calendar = {};
        let telegramSettings = { token: '', chatId: '' };
        const timeSlots = ["09:00-11:00", "11:00-13:00", "13:00-15:00", "15:00-17:00", "17:00-19:00"];
        let selectedSlots = [];

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ü–µ–Ω
        let prices = {
            'sofa_2': { name: '–î–∏–≤–∞–Ω 2-–º–µ—Å—Ç–Ω—ã–π', price: 1700 },
            'sofa_3': { name: '–î–∏–≤–∞–Ω 3-–º–µ—Å—Ç–Ω—ã–π', price: 2200 },
            'armchair': { name: '–ö—Ä–µ—Å–ª–æ', price: 1300 },
            'mattress_1': { name: '–ú–∞—Ç—Ä–∞—Å –æ–¥–Ω–æ—Å–ø–∞–ª—å–Ω—ã–π', price: 1600 },
            'mattress_2': { name: '–ú–∞—Ç—Ä–∞—Å –¥–≤—É—Å–ø–∞–ª—å–Ω—ã–π', price: 2000 },
            'carpet_3': { name: '–ö–æ–≤–µ—Ä –¥–æ 3–º¬≤', price: 900 },
            'carpet_6': { name: '–ö–æ–≤–µ—Ä 3-6–º¬≤', price: 1500 },
            'carpet_6plus': { name: '–ö–æ–≤–µ—Ä –æ—Ç 6–º¬≤', price: 2400 }
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('preloader').classList.add('hidden');
            }, 1000);
            checkAuth();
            loadPricesFromStorage();
            loadTelegramSettings();
        });

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainPage();
            }
        }

        function showMainPage() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('userRole').textContent = `${currentUser.name} (${currentUser.role === 'main_admin' ? '–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω' : '–ê–¥–º–∏–Ω'})`;
            loadOrders();
            updateStats();
            loadCalendar();
            loadPromotions();
        }

        function login() {
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            
            const users = {
                'main': { password: 'main123', name: '–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', role: 'main_admin' },
                'admin': { password: '123456', name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', role: 'admin' }
            };
            
            if (users[login] && users[login].password === password) {
                currentUser = { login: login, name: users[login].name, role: users[login].role };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainPage();
                alert('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É');
            } else {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainPage').classList.add('hidden');
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏
        function loadPrices() {
            const editor = document.getElementById('pricesEditor');
            let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';
            
            Object.keys(prices).forEach(key => {
                const item = prices[key];
                html += `
                    <div style="background: rgba(26, 26, 26, 0.8); padding: 20px; border-radius: 10px; border: 1px solid #333;">
                        <div style="margin-bottom: 10px; font-weight: 600; color: #FFFFFF;">${item.name}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" 
                                   id="price_${key}" 
                                   value="${item.price}" 
                                   style="flex: 1; padding: 12px; background: rgba(37, 37, 37, 0.8); border: 2px solid #333; border-radius: 8px; color: #FFFFFF;"
                                   min="0">
                            <span style="color: #D4AF37; font-weight: 700;">‚ÇΩ</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            editor.innerHTML = html;
            alert('‚úÖ –¶–µ–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        }

        function savePrices() {
            Object.keys(prices).forEach(key => {
                const input = document.getElementById(`price_${key}`);
                if (input) {
                    prices[key].price = parseInt(input.value) || 0;
                }
            });
            
            localStorage.setItem('cleaning_prices', JSON.stringify(prices));
            alert('‚úÖ –¶–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        function loadPricesFromStorage() {
            const saved = localStorage.getItem('cleaning_prices');
            if (saved) {
                prices = JSON.parse(saved);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫
        function loadOrders() {
            const tbody = document.getElementById('ordersBody');
            tbody.innerHTML = '';

            // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            const testOrders = [
                { id: 1, date: "2024-01-15 14:30", client: { name: "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤", phone: "+79123456789" }, order: { product_name: "–î–∏–≤–∞–Ω 2-–º–µ—Å—Ç–Ω—ã–π", total: 1700 }, status: "new" },
                { id: 2, date: "2024-01-14 11:20", client: { name: "–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞", phone: "+79234567890" }, order: { product_name: "–ö—Ä–µ—Å–ª–æ", total: 1300 }, status: "in_progress" },
                { id: 3, date: "2024-01-13 16:45", client: { name: "–ü–µ—Ç—Ä –ò–≤–∞–Ω–æ–≤", phone: "+79345678901" }, order: { product_name: "–ú–∞—Ç—Ä–∞—Å –¥–≤—É—Å–ø–∞–ª—å–Ω—ã–π", total: 2000 }, status: "completed" }
            ];

            orders = testOrders;

            orders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.date}</td>
                    <td>${order.client.name}</td>
                    <td>${order.client.phone}</td>
                    <td>${order.order.product_name}</td>
                    <td>${order.order.total} —Ä—É–±.</td>
                    <td>
                        <select onchange="changeStatus(${order.id}, this.value)" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #333; background: rgba(26, 26, 26, 0.8); color: #FFFFFF;">
                            <option value="new" ${order.status === 'new' ? 'selected' : ''}>–ù–æ–≤—ã–π</option>
                            <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</option>
                            <option value="in_progress" ${order.status === 'in_progress' ? 'selected' : ''}>–í —Ä–∞–±–æ—Ç–µ</option>
                            <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>–í—ã–ø–æ–ª–Ω–µ–Ω</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn" onclick="editOrder(${order.id})" style="padding: 8px 12px; font-size: 12px;">‚úèÔ∏è</button>
                        <button class="btn" onclick="deleteOrder(${order.id})" style="padding: 8px 12px; font-size: 12px; background: #e74c3c;">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateStats();
        }

        function updateStats() {
            const total = orders.length;
            const completed = orders.filter(o => o.status === 'completed').length;
            const progress = orders.filter(o => o.status === 'in_progress').length;
            const newOrders = orders.filter(o => o.status === 'new').length;

            document.getElementById('totalOrders').textContent = total;
            document.getElementById('completedOrders').textContent = completed;
            document.getElementById('progressOrders').textContent = progress;
            document.getElementById('newOrders').textContent = newOrders;
        }

        function changeStatus(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                updateStats();
                alert(`‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #${orderId} –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ "${newStatus}"`);
            }
        }

        function editOrder(orderId) {
            alert(`‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ #${orderId} - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`);
        }

        function deleteOrder(orderId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É?')) {
                orders = orders.filter(o => o.id !== orderId);
                loadOrders();
                alert('‚úÖ –ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å
        function loadCalendar() {
            const date = document.getElementById('calendarDate').value;
            document.getElementById('currentDate').textContent = new Date(date).toLocaleDateString('ru-RU');
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            if (!calendar[date]) {
                calendar[date] = {
                    "09:00-11:00": { status: "free" },
                    "11:00-13:00": { status: "busy", order_id: 1 },
                    "13:00-15:00": { status: "free" },
                    "15:00-17:00": { status: "free" },
                    "17:00-19:00": { status: "blocked", reason: "–¢–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ" }
                };
            }

            timeSlots.forEach(slot => {
                const slotData = calendar[date][slot];
                const slotElement = document.createElement('div');
                slotElement.className = `time-slot ${slotData.status} ${selectedSlots.includes(slot) ? 'selected' : ''}`;
                slotElement.textContent = slot;
                slotElement.onclick = () => toggleSlotSelection(slot);
                calendarGrid.appendChild(slotElement);
            });
        }

        function toggleSlotSelection(slot) {
            const index = selectedSlots.indexOf(slot);
            if (index === -1) {
                selectedSlots.push(slot);
            } else {
                selectedSlots.splice(index, 1);
            }
            loadCalendar();
        }

        function blockSelectedSlots() {
            if (selectedSlots.length === 0) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
                return;
            }
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã');
            if (reason) {
                alert(`‚úÖ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ ${selectedSlots.length} –æ–∫–æ–Ω`);
                selectedSlots = [];
                loadCalendar();
            }
        }

        function unblockSelectedSlots() {
            if (selectedSlots.length === 0) {
                alert('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
                return;
            }
            alert(`‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ ${selectedSlots.length} –æ–∫–æ–Ω`);
            selectedSlots = [];
            loadCalendar();
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
        function publishCalendar() {
            localStorage.setItem('cleaning_calendar', JSON.stringify(calendar));
            alert('‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤!');
        }

        function viewClientCalendar() {
            window.open('client-booking.html', '_blank');
        }

        function loadClientOrders() {
            const clientOrders = JSON.parse(localStorage.getItem('cleaning_orders') || '[]');
            let newOrdersCount = 0;
            
            clientOrders.forEach(clientOrder => {
                if (!orders.find(order => order.id === clientOrder.id)) {
                    orders.push(clientOrder);
                    newOrdersCount++;
                }
            });
            
            loadOrders();
            alert(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${newOrdersCount} –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤`);
        }

        // Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function saveTelegramSettings() {
            telegramSettings.token = document.getElementById('telegramToken').value;
            telegramSettings.chatId = document.getElementById('telegramChatId').value;
            localStorage.setItem('telegramSettings', JSON.stringify(telegramSettings));
            alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        function testTelegramNotification() {
            if (!telegramSettings.token || !telegramSettings.chatId) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ ID —á–∞—Ç–∞!');
                return;
            }
            alert('‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
        }

        function loadTelegramSettings() {
            const saved = localStorage.getItem('telegramSettings');
            if (saved) {
                telegramSettings = JSON.parse(saved);
                document.getElementById('telegramToken').value = telegramSettings.token || '';
                document.getElementById('telegramChatId').value = telegramSettings.chatId || '';
            }
        }

        // –ê–∫—Ü–∏–∏
        function showAddPromotionForm() {
            alert('‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ü–∏–∏ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function loadPromotions() {
            document.getElementById('promotionsList').innerHTML = `
                <div style="background: rgba(26, 26, 26, 0.8); padding: 20px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #10B981;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                        <strong style="flex: 1; color: #FFFFFF;">–ü–µ—Ä–≤–∞—è —Ö–∏–º—á–∏—Å—Ç–∫–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π 15%</strong>
                        <span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">-15%</span>
                    </div>
                    <div style="color: #B0B0B0; font-size: 14px;">–î–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Ä¢ –î–æ 31.12.2024</div>
                </div>
            `;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('calendarDate').addEventListener('change', loadCalendar);
        document.getElementById('statusFilter').addEventListener('change', loadOrders);
        
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        loadPromotions();
    </script>
</body>
</html>
